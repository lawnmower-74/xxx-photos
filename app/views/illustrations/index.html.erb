<div style="max-width: 1000px; margin: 0 auto; padding: 20px;">
  <h1>ã‚¤ãƒ©ã‚¹ãƒˆç®¡ç† - ãƒ•ã‚©ãƒ«ãƒ€ä¸€è¦§</h1>

  <%# --- ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã‚»ã‚¯ã‚·ãƒ§ãƒ³ (å¤‰æ›´ãªã—) --- %>
  <section style="background: #f9f9f9; padding: 20px; border-radius: 8px; margin-bottom: 40px;">
    <h2>æ–°è¦ä¸€æ‹¬ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰</h2>
    <form id="upload-form">
      <div style="margin-bottom: 15px;">
        <label style="display: block; font-weight: bold;">ä½œè€…åï¼ˆãƒ•ã‚©ãƒ«ãƒ€åã«ãªã‚Šã¾ã™ï¼‰</label>
        <input type="text" id="illustrator-name" required style="width: 100%; padding: 8px;">
      </div>

      <div style="margin-bottom: 15px;">
        <label style="display: block; font-weight: bold;">ç”»åƒé¸æŠï¼ˆè¤‡æ•°å¯ï¼‰</label>
        <input type="file" id="image-input" multiple accept="image/*" required>
      </div>

      <button type="submit" id="submit-btn" style="padding: 10px 20px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer;">
        ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰é–‹å§‹
      </button>
    </form>

    <div id="upload-status" style="margin-top: 15px; font-weight: bold; color: #007bff;"></div>
  </section>

  <hr style="margin: 40px 0;">

  <%# --- ãƒ•ã‚©ãƒ«ãƒ€ä¸€è¦§ã‚»ã‚¯ã‚·ãƒ§ãƒ³ --- %>
  <h2>ã‚¤ãƒ©ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¿ãƒ¼åˆ¥ãƒ•ã‚©ãƒ«ãƒ€</h2>
  <div id="folder-list" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: 20px; margin-top: 20px;">
    <% @illustrators.each do |illustrator| %>
      <%= link_to illustrator_folder_path(name: illustrator.name), class: "folder-item", style: "text-decoration: none; color: inherit;" do %>
        <div style="border: 1px solid #ddd; padding: 20px; border-radius: 10px; text-align: center; background: white; transition: 0.2s; box-shadow: 0 2px 4px rgba(0,0,0,0.05);">
          <div style="font-size: 50px; margin-bottom: 10px;">ğŸ“</div>
          <div style="font-weight: bold; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">
            <%= illustrator.name %>
          </div>
          <div style="font-size: 12px; color: #888; margin-top: 5px;">
            <%= illustrator.illustrations.count %> æš
          </div>
        </div>
      <% end %>
    <% end %>
  </div>
</div>

<style>
  .folder-item:hover div {
    transform: translateY(-5px);
    border-color: #007bff !important;
    background-color: #f0f7ff !important;
  }
</style>

<script>
document.addEventListener("DOMContentLoaded", () => {
  const uploadForm = document.getElementById("upload-form");
  if (!uploadForm) return;

  uploadForm.addEventListener("submit", async (e) => {
    e.preventDefault();

    const nameInput = document.getElementById("illustrator-name");
    const imageInput = document.getElementById("image-input");
    const status = document.getElementById("upload-status");
    const submitBtn = document.getElementById("submit-btn");

    const files = imageInput.files;
    const name = nameInput.value;
    const csrfToken = document.querySelector('meta[name="csrf-token"]').content;

    submitBtn.disabled = true;
    submitBtn.innerText = "å‡¦ç†ä¸­...";

    for (let i = 0; i < files.length; i++) {
      status.innerText = `${files.length}æšä¸­ ${i + 1}æšç›®ã‚’é€ä¿¡ä¸­...`;

      const formData = new FormData();
      formData.append("illustration[illustrator_name]", name);
      formData.append("illustration[image]", files[i]);

      try {
        const response = await fetch("/illustrations", {
          method: "POST",
          headers: { "X-CSRF-Token": csrfToken },
          body: formData
        });

        const result = await response.json();

        if (!response.ok) {
          status.innerText = `ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿ: ${result.error || 'ä¿å­˜å¤±æ•—'}`;
          status.style.color = "red";
          submitBtn.disabled = false;
          return;
        }
      } catch (err) {
        status.innerText = "é€šä¿¡ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ";
        status.style.color = "red";
        submitBtn.disabled = false;
        return;
      }
    }

    status.innerText = "å®Œäº†ã—ã¾ã—ãŸï¼ãƒªãƒ­ãƒ¼ãƒ‰ã—ã¦ãƒ•ã‚©ãƒ«ãƒ€ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚";
    status.style.color = "green";
    
    // ãƒ•ã‚©ãƒ«ãƒ€æ§‹æˆãŒå¤‰ã‚ã‚‹ãŸã‚ã€å®Œäº†å¾Œã«è‡ªå‹•ãƒªãƒ­ãƒ¼ãƒ‰ã™ã‚‹ã®ãŒä¸€ç•ªç¢ºå®Ÿã§ã™
    setTimeout(() => {
      window.location.reload();
    }, 1500);
  });
});
</script>